<!DOCTYPE HTML>
<HTML lang="en">
	<head>
		<title>My Calendar</title>
		<meta charset="UTF-8">

		<link rel="stylesheet" href="fullcalendar/core/main.css" />
		<link rel="stylesheet" href="fullcalendar/daygrid/main.css" />
		<link rel="stylesheet" href="fullcalendar/timegrid/main.css" />

		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>

		<script src="fullcalendar/core/main.js"></script>
		<script src="fullcalendar/daygrid/main.js"></script>
		<script src="fullcalendar/timegrid/main.js"></script>
		<script src="fullcalendar/interaction/main.js"></script>

		<script>
			document.addEventListener("DOMContentLoaded", function() {
				var Calendar = FullCalendar.Calendar;
				var Draggable = FullCalendarInteraction.Draggable;

				var containerE1 = document.getElementById("external-events");
				var calendarE1 = document.getElementById("calendar");
				var checkbox = document.getElementById("drop-remove");

				new Draggable(containerE1, {
					itemSelector: ".fc-event",
					eventData: function(eventE1) {
						return {
							title: eventE1.innerText
						};
					}
				});

				var calendar = new Calendar(calendarE1, {
					plugins: [ "interaction", "dayGrid", "timeGrid" ],
					defaultView: "timeGridWeek",
					header: {
						left: "prev,next today addEventButton",
						center: "title",
						right: "dayGridMonth,timeGridWeek,timeGridDay"
					},
					customButtons: {
						addEventButton: {
							text: 'Save',
							click: function() {
								var ev = calendar.getEvents();
								var counter = 0;
								var lIndex = ev.length - 1;
								while(counter < ev.length) {
									var t = ev[counter].title;
									var s = ev[counter].start;
									var e = ev[counter].end;
									var st = s.toISOString();
									var en = e.toISOString();
									$.ajax({
										url: '/getEvents',
										type: 'POST',
										data: {
											title: t,
											start: st,
											end: en,
											index: counter,
											lastIndex: lIndex
										}
									})
									counter++;
								}
							}
						}
					},
					selectable: true,
					selectMirror: true,
					editable: true,
					droppable: true,

					events : "/assets/sampleEventCalendar.json",

					select: function(eventE) {
						var title = prompt('Event title: ');
						if(title) {
							calendar.addEvent({
								title: title,
								start: eventE.start,
								end: eventE.end,
								allDay: eventE.allDay
							})
						}
						calendar.unselect()
					}
				});

				calendar.on('eventClick', function(eventE) {
					var del = confirm("Delete this event?\nEvent Name: " + eventE.event.title + "\nStart time: " + eventE.event.start + "\nEnd  time: " + eventE.event.end);
					if(del) {
						var del2 = confirm("Are you sure you want to delete: " + eventE.event.title + "?");
						if(del2) {
							eventE.event.remove();
						}
					}
					calendar.unselect()
				});

				calendar.render();
			});
		</script>

		<style>
			html, body {
				margin: 0;
				padding: 0;
				font-family: Arial, Helvetica Neue, Helvetica, sans-serif;
				font-size: 14px;
			}

			#external-events {
				position: fixed;
				z-index: 2;
				top: 20px;
				left: 20px;
				width: 150px;
				padding: 0 10px;
				border: 1px solid #ccc;
				background: #eee;
			}

			#external-events .fc-event {
				margin: 1em 0;
				cursor: move;
			}

			#calendar-container {
				position: relative;
				z-index: 1;
				margin-left: 200px;
			}

			#calendar {
				max-width: 900px;
				margin: 20px auto;
			}
		</style>
	</head>
	<body>
		<div id="external-events">
			<p>
				<p><a href="index.html">Home</a><br><a href="about-us.html">About Us</a><br><a href="login.html">Login</a><br><a href="register.html">Register</a><br></p>
				Drag predefined events onto calendar or click on blank spaces to add events.
				<br><br><strong>Draggable Events</strong>
			</p>
			<div class="fc-event">Work</div>
			<div class="fc-event">School</div>
		</div>
		<div id="calendar-container">
			<div id="calendar"></div>
		</div>
	</body>
</HTML>